@model CarpoolingCR.Objects.Responses.BlockingAmountResponse

<h2>@ViewBag.Title</h2>

@{
    var claims = (System.Security.Claims.ClaimsIdentity)User.Identity;
    var value = string.Empty;
    var obj = claims.FindFirst("CurrencyChar");
    var currency = string.Empty;

    if (obj != null)
    {
        currency = obj.Value;
    }
}
<div class="row form-group" style="text-align:center">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        @{
            if (Model.Type == "expenses")
            {
                <h5 class="pull-left">Gastos Bloqueados</h5>
            }
            else if (Model.Type == "incomes")
            {
                <h5 class="pull-left">Ingresos Bloqueados</h5>
            }
            else if (Model.Type == "movements")
            {
                <h5 class="pull-left">Movimientos</h5>
            }
        }
    </div>
</div>
@{

    if (Model.Type == "movements")
    {
        if (Model.Historial.Count() == 0)
        {
            <div class="row form-group">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align:center">
                    @{
                        <small>¡No hay movimiento de ridecoins registrados!</small>
                    }
                </div>
            </div>
        }
        else
        {
            foreach (var item in Model.Historial)
            {
                <div class="panel panel-default" style="padding-left:10px; padding-right:10px; padding-top:10px; padding-bottom:0px; border-radius: 10px">
                    <div class="row form-group">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 pull-left">
                            <span class="fas fa-map-marker-alt">&nbsp;</span><small>@item.Detail</small><br />
                            <span class="fas fa-calendar-alt"></span><small> <b>@item.Date.ToString("dddd dd 'de' MMMM 'del' yyyy")</b></small><br />
                            @{
                                if (item.RidecoinsAmount < 0)
                                {
                                    <i class="fas fa-coins">&nbsp;</i><small class="text-danger">Ridecoins: @currency@item.RidecoinsAmount.ToString("N2")</small><br />
                                    <i class="fas fa-money-bill-alt">&nbsp;</i><small class="text-danger">Efectivo: @currency@item.CashAmount.ToString("N2")</small>
                                }
                                else
                                {
                                    <i class="fas fa-coins">&nbsp;</i><small class="text-success">Ridecoins: @currency@item.RidecoinsAmount.ToString("N2")</small><br />
                                    <i class="fas fa-money-bill-alt">&nbsp;</i><small class="text-success">Efectivo: @currency@item.CashAmount.ToString("N2")</small>
                                }
                            }
                        </div>
                    </div>
                </div>
            }
        }
    }
    else
    {
        if (Model.Balances.Count() == 0)
        {
            <div class="row form-group">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align:center">
                    @{
                        if (Model.Type == "expenses")
                        {
                            <small>¡No hay gastos de ridecoins registrados!</small>
                        }
                        else if (Model.Type == "incomes")
                        {
                            <small>¡No hay ingreso de ridecoins registrados!</small>
                        }
                        else if (Model.Type == "movements")
                        {
                            <small>¡No hay movimientos de ridecoins registrados!</small>
                        }
                    }
                </div>
            </div>
        }
        else
        {
            foreach (var item in Model.Balances)
            {
                //reservation balances
                if (item.ReservationId != null)
                {
                    <div class="panel panel-default" style="padding-left:10px; padding-right:10px; padding-top:10px; padding-bottom:0px; border-radius: 10px">
                        <div class="row form-group">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 pull-left">
                                <span class="fas fa-map-marker-alt">&nbsp;</span><small>@item.Reservation.Trip.FromTown.FullName</small><br />
                                <span class="fas fa-map-marker-alt">&nbsp;</span><small>@item.Reservation.Trip.ToTown.FullName</small><br />
                                <span class="fas fa-calendar-alt"></span><small> <b>@item.Reservation.Trip.DateTime.ToString("dddd dd 'de' MMMM 'del' yyyy")</b></small><br />
                                @{
                                    if (Model.Type == "expenses")
                                    {
                                        if (item.PromoAmount > 0m)
                                        {
                                            <i class="fas fa-receipt">&nbsp;</i><small class="text-success">Bono: @currency @item.PromoAmount.ToString("N2")</small>
                                        }
                                        else
                                        {
                                            <i class="fas fa-receipt">&nbsp;</i><small>Bono: @currency @item.PromoAmount.ToString("N2")</small>
                                        }
                                        <br />
                                        <i class="fas fa-coins">&nbsp;</i><small class="text-danger">Ridecoins: @currency @Convert.ToDecimal(item.BlockedBalanceAmount * -1).ToString("N2")</small><br />
                                        <i class="fas fa-money-bill-alt">&nbsp;</i><small class="text-danger">Debes pagar en efectivo: @currency @item.Reservation.totalPayedWithCash.ToString("N2")</small>
                                    }
                                    else if (Model.Type == "incomes")
                                    {
                                        <i class="fas fa-coins">&nbsp;</i><small class="text-success">Ridecoins: @currency @Convert.ToDecimal(item.BlockedBalanceAmount + item.PromoAmount).ToString("N2")</small><br />
                                        <i class="fas fa-money-bill-alt">&nbsp;</i><small class="text-success">Pago en efectivo: @currency @Convert.ToDecimal(item.Reservation.totalPayedWithCash).ToString("N2")</small>
                                    }
                                }
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                @{
                                    if (Model.Type == "expenses")
                                    {
                                        @Html.Partial("~/Views/Account/Partials/p_UserOverallInfo.cshtml", item.ToUser)
                                    }
                                    else if (Model.Type == "incomes")
                                    {
                                        @Html.Partial("~/Views/Account/Partials/p_UserOverallInfo.cshtml", item.FromUser)
                                    }
                                }

                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <small>@item.Detail</small>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    //trip balances
                    <div class="panel panel-default" style="padding-left:10px; padding-right:10px; padding-top:10px; padding-bottom:0px; border-radius: 10px">
                        <div class="row form-group">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 pull-left">
                                <span class="fas fa-map-marker-alt">&nbsp;</span><small>@item.Trip.FromTown.FullName</small><br />
                                <span class="fas fa-map-marker-alt">&nbsp;</span><small>@item.Trip.ToTown.FullName</small><br />
                                <span class="fas fa-calendar-alt"></span><small> <b>@item.Trip.DateTime.ToString("dddd dd 'de' MMMM 'del' yyyy")</b></small><br />
                                <i class="fas fa-coins">&nbsp;</i><small class="text-success">Ridecoins: @currency @Convert.ToDecimal(item.BlockedBalanceAmount + item.PromoAmount).ToString("N2")</small><br />
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">

                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <small>@item.Detail</small>
                            </div>
                        </div>
                    </div>
                }
            }
        }
    }
}

