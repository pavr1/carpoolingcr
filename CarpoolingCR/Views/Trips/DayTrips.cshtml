@model CarpoolingCR.Objects.Responses.TripDayTripsResponse

@{
    /**/

    ViewBag.Title = "MonthTrips";
}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<div class="form-group">
    <div class="row form-group" style="text-align:center">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <h5 class="pull-left">Viajes Disponibles</h5>
        </div>
    </div>
</div>
@*<label class="control-label">@ViewBag.Info</label>*@

<input id="AvailableSpaces" type="hidden" value="" />
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <span class="fas fa-map-marker-alt">&nbsp;</span><small>@Model.From</small> <br />
        <span class="fas fa-map-marker-alt">&nbsp;</span><small>@Model.To</small> <br />
    </div>
</div>
<div class="row form-group">
    <div id="dayCalendar" style="overflow:hidden" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="dayTripModal" tabindex="-1" role="dialog" aria-labelledby="dayTripModalLabel" aria-hidden="true">
    <form id="frmCreateReservation" action="~/Reservations/Create" method="post">
        <input id="RequestedSpaces" name="RequestedSpaces" type="text" class="hidden" style="width:40px;" onfocus="blur();">
        <input id="SpacesSelected" name="SpacesSelected" type="text" class="hidden" style="width:40px;" onfocus="blur();">
        <input id="SelectedSeatsTotalPrice" name="SelectedSeatsTotalPrice" type="text" class="hidden" style="width:40px;" onfocus="blur();">
        <input type="text" id="TripId" name="TripId" class="hidden" />
        @Html.AntiForgeryToken()
        @{
            var claims = (System.Security.Claims.ClaimsIdentity)User.Identity;
            var value = string.Empty;
            var currencyObj = claims.FindFirst("CurrencyChar");
            var currency = string.Empty;
            var country = string.Empty;
            var balanceObj = claims.FindFirst("Balance");
            var promo = Convert.ToDecimal(ViewBag.Promo);

            if (currencyObj != null)
            {
                currency = currencyObj.Value;
            }

            var balance = 0m;

            if (balanceObj != null)
            {
                balance = Convert.ToDecimal(balanceObj.Value);
            }
        }
        <div class="vertical-alignment-helper">
            <div class="modal-dialog vertical-align-center">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                        </button>
                        <h4 class="modal-title" id="dayTripModalLabel">Reserva tu viaje</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-group">
                            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                <span class="fas fa-calendar-alt"></span><small> <b><small id="modelDate"></small></b></small><br />
                                <input type="text" id="ReservationDate" name="ReservationDate" class="hidden" />

                                <span class="fas fa-clock"></span>&nbsp;<small id="fromTime"></small>&nbsp;&nbsp;<br class="visible-xs" /><span class="fas fa-map-marker-alt">&nbsp;</span><small id="modelFrom"></small><br />
                                <span class="fas fa-clock"></span>&nbsp;<small id="toTime"></small>&nbsp;&nbsp;<br class="visible-xs" /><span class="fas fa-map-marker-alt">&nbsp;</span><small id="modelTo"></small><br />
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                @{ 
                                    //set this property to true so when the user clicks over the user's control to see its information, there will be no action, in this place we do not want any pop up
                                    ViewBag.HideUserDetail = true;
                                }

                                @Html.Partial("~/Views/Account/Partials/p_UserOverallInfo.cshtml", Model.CurrentUser)
                                @*<div id="profile-container-small" data-toggle="tooltip" style="margin-right:15px" title="Conductor" class="pull-right">
                                        <img id="driver-img" />
                                    </div><br /><br /><br />
                                    <small id="modelDriver" class="pull-right"></small><br />*@
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <small><b><span class="fas fa-route">&nbsp;</span>Ruta: </b></small><small id="modelRoute"></small><br />
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <small><b><span class="fas fa-road">&nbsp;</span>Distancia: </b></small><small id="modelDistance"></small><br />
                            </div>
                        </div>
                        <div class="row form-group btn-group center-block" style="padding-left:0px; padding-right:13px; margin-bottom:0px">
                            <div id="modelpet" class="btn btn-xs btn-info col-md-4 col-sm-4 col-xs-4 panel panel-default allow-checkboxes" data-toggle="button" aria-pressed="false" autocomplete="off" style="border-radius:10px 0px 0px 10px; width:70px; pointer-events:none">
                                <span class="fas fa-dog">&nbsp;</span>&nbsp;<span id="modelcheck-pet" class="fas fa-check-circle hidden">&nbsp;</span><br /><label class="control-label" style="text-align:left">Mascotas </label>
                                <input type="text" id="ck-pet" name="ck-pet" style="display:none" />
                            </div>
                            <div id="modelluggage" class="btn btn-xs btn-info col-lg-4 col-md-4 col-sm-4 col-xs-4 panel panel-default allow-checkboxes" data-toggle="button" aria-pressed="false" autocomplete="off" style="border-radius:0px; width:70px; pointer-events:none">
                                <span class="fas fa-suitcase-rolling">&nbsp;</span>&nbsp;<span id="modelcheck-luggage" class="fas fa-check-circle hidden">&nbsp;</span><br /><label class="control-label" style="text-align:left">Equipaje </label>
                                <input type="text" id="ck-luggage" name="ck-luggage" style="display:none" />
                            </div>
                            <div id="modelsmoking" class="btn btn-xs btn-info col-lg-4 col-md-4 col-sm-4 col-xs-4 panel panel-default allow-checkboxes" data-toggle="button" aria-pressed="false" autocomplete="off" style="border-radius:0px 10px 10px 0px; width:70px; pointer-events:none">
                                <span class="fas fa-smoking">&nbsp;</span>&nbsp;<span id="modelcheck-smoking" class="fas fa-check-circle hidden">&nbsp;</span><br /><label class="control-label" style="text-align:left">Fumado</label>
                                <input type="text" id="ck-smoking" name="ck-smoking" style="display:none" />
                            </div>
                        </div>
                        <hr />
                        <div class="row form-group">
                            <div id="already-reserved-message" class="col-lg-8 col-md-8 col-sm-8 col-xs-6">
                                <small><b>¡Selecciona tus asientos! </b></small>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
                                <input id="hidden-balance" type="hidden" value="@balance.ToString().Replace(",",".")" />
                                <input id="hidden-bono" type="hidden" value="@promo.ToString().Replace(",",".")" />
                                <span class="badge badge-success pull-right"><i class="fas fa-coins">&nbsp;</i><b>Tus Ridecoins</b><br />@currency <span id="modelBalance" name="modelBalance">@balance.ToString("N2")</span></span><br />
                                <input type="text" id="actualBalance" name="actualBalance" class="hidden" />
                                <input type="text" id="promo-id" name="promo-id" class="hidden" value="@ViewBag.PromoId" />
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                                <span class="badge badge-success pull-left"><i class="fas fa-money-bill-alt">&nbsp;</i><b>Monto a cancelar</b><br />@currency <span id="modelTotal" name="modelTotal"></span></span><br />
                                <input type="text" id="actualTotal" name="actualTotal" class="hidden" />
                            </div>
                            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                                <span class="badge badge-success pull-right"><i class="fas fa-receipt">&nbsp;</i><b>Bono: </b><br />@currency <span id="modelBonoTotal" name="modelBonoTotal"></span></span><br />
                                <input type="text" id="bonoPayment" name="bonoPayment" class="hidden" />
                            </div>
                            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                                <span class="badge badge-success center-block"><i class="fas fa-coins">&nbsp;</i><b>Ridecoins</b><br />@currency <span id="modelBalanceTotal" name="modelBalanceTotal"></span></span><br />
                                <input type="text" id="balancePayment" name="balancePayment" class="hidden" />
                            </div>
                            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                                <span class="badge badge-success pull-right"><i class="fas fa-money-bill-alt">&nbsp;</i><b>Efectivo: </b><br />@currency <span id="modelCashTotal" name="modelCashTotal"></span></span><br />
                                <input type="text" id="cashPayment" name="cashPayment" class="hidden" />
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align:center">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <table border="0" style="padding:0px;margin:0px;position:relative;text-align:center;display:inline; top:-40px">
                                                <tr style="height:30px">
                                                    <td colspan="3" style="height:30px">
                                                        <div style="height: 15px;width: 40px;background-color: yellow;border-radius: 50%;position:relative; top:75px; left:20px; z-index:10; -ms-transform: rotate(-20deg); -webkit-transform: rotate(-20deg); transform: rotate(-20deg);"></div>
                                                        <div style="height: 15px;width: 40px;background-color: yellow;border-radius: 50%;position:relative; top:60px; left:123px; z-index:10; -ms-transform: rotate(20deg); -webkit-transform: rotate(20deg); transform: rotate(20deg);"></div>
                                                        <div style="border-radius:50px 50px 0px 0px; background-color:#004a93; width:100%; height:100px;position:relative;top:37px; left:0px;"></div>
                                                        <div class="center-block" style="border-radius:50px 50px 0px 0px; background-color:gainsboro; width:100%; height:35px;position:relative; width:90%"></div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:10px; padding-right:0px">
                                                            <input type="checkbox" disabled id="driver-seat" />
                                                            <label for="driver-seat">Conductor</label>
                                                        </div>
                                                    </td>
                                                    <td style="background-color:#004a93"></td>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:0px; padding-right:10px">
                                                            <input type="checkbox" id="copilot-seat" class="seats" />
                                                            <label for="copilot-seat" style="color:darkblue"><small>@currency</small><small id="modelPriceCopilot"></small></label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:10px; padding-right:0px">
                                                            <input type="checkbox" id="back-left-seat" class="seats" />
                                                            <label for="back-left-seat" style="color:darkblue"><small>@currency</small><small id="modelPriceLeft"></small></label>
                                                        </div>
                                                    </td>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:0px; padding-right:0px">
                                                            <input type="checkbox" id="back-middle-seat" class="seats" />
                                                            <label for="back-middle-seat" style="color:darkblue"><small>@currency</small><small id="modelPriceMiddle"></small></label>
                                                        </div>
                                                    </td>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:0px; padding-right:10px">
                                                            <input type="checkbox" id="back-right-seat" class="seats" />
                                                            <label for="back-right-seat" style="color:darkblue"><small>@currency</small><small id="modelPriceRight"></small></label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3">
                                                        <div class="center-block" style="border-radius:0px 0px 25px 25px; background-color:#004a93; width:100%; height:60px;"></div>
                                                        <div class="center-block" style="border-radius:0px 0px 50px 50px; background-color:gainsboro; width:90%; height:20px;position:relative;top:-60px; left:0px;"></div>
                                                    </td>
                                                </tr>
                                            </table>

                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <div id="btnsContainer" class="modal-footer" style="top:-50px; padding-top:5px; padding-left:0px; padding-right:0px">
                                    <input type="button" onclick="OpenMessageModel()" class="btn btn-default pull-left" value="&#9993;" />
                                    <input type="button" class="btn btn-default btn-sm" data-dismiss="modal" value="Cancelar" />
                                    <input id="btnSubmitReservations" type="button" onclick="SubmitForm();" style="width:150px" class="btn btn-info btn-sm" value="Solicitar Reserva" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="modal fade" id="tripQuestionsModal" tabindex="-1" role="dialog" aria-labelledby="tripQuestionsModalLabel" aria-hidden="true">
    @*<form action="~/Reservations/Create" method="post">*@<form action="~/Reservations/Create" method="post">
        @Html.AntiForgeryToken()
        <div class="vertical-alignment-helper">
            <div class="modal-dialog vertical-align-center">
                <div class="modal-content">
                    <div class="modal-header">
                        <input type="text" id="MsgDriverId" name="MsgDriverId" class="hidden" />
                        <input type="text" id="MsgPassengerId" name="DriverId" class="hidden" value="@Model.CurrentUserId" />
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                        </button>
                        <h4 class="modal-title" id="dayTripModalLabel">Mensajes</h4>
                        <small>¿Alguna duda? ¡Contácta al conductor!</small>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <textarea class="form-control" id="Message" name="Message" style="height:200px; min-width:100%"></textarea>
                            </div>
                        </div>
                    </div>
                    <div id="btnsContainer" class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cerrar" />
                        <input type="button" class="btn btn-primary" onclick="SendMessage()" value="Enviar" />
                    </div>
                </div>
            </div>
        </div>
        @*</form>*@
    </form>
</div>

<link href="~/fonts/fullcalendar-3.10.0/fullcalendar.min.css" rel="stylesheet" />
<script src="~/fonts/fullcalendar-3.10.0/moment.min.js"></script>
<script src="~/fonts/fullcalendar-3.10.0/fullcalendar.min.js"></script>
<script>
    function SubmitForm() {
        if ($('#SpacesSelected').val() == '') {
            //¡Por favor seleccione al menos un campo!
            DisplayGrowlMessage('100073', 'warn');

            return;
        }

        $('#frmCreateReservation').submit();
    }
    var totalSelectedSeats = Number(0);

    $(".seats").change(function () {
    var controlId = this.id;
    var valueControlId = "";

    switch (controlId) {
        case "copilot-seat":
            valueControlId = "modelPriceCopilot";
            break;
        case "back-left-seat":
            valueControlId = "modelPriceLeft";
            break;
        case "back-middle-seat":
            valueControlId = "modelPriceMiddle";
            break;
        case "back-right-seat":
            valueControlId = "modelPriceRight";
            break;
    }

    var value = Number($('#' + valueControlId).html());


    if (this.checked) {
            totalSelectedSeats = Number(totalSelectedSeats) + value;
        } else {
            totalSelectedSeats = Number(totalSelectedSeats) - value;
        }

        var requestedSpaces = 0;
        var requestedSpacesControlIds = "";

        if($("#copilot-seat").prop('checked')){
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceCopilot;";
        }
        if ($("#back-left-seat").prop('checked')) {
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceLeft;";
        }
        if ($("#back-middle-seat").prop('checked')) {
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceMiddle;";
        }
        if ($("#back-right-seat").prop('checked')) {
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceRight;";
        }

        var cash = 0;
        var bal = $('#hidden-balance').val();
        var promo = Number($('#hidden-bono').val());
        var balance = Number(bal);
        var paymentWithBalance = 0;
        var paymentWithPromo = 0;
        var totalPaymentWithoutPromo = totalSelectedSeats;

        if (promo > 0) {
            if (totalSelectedSeats >= promo) {
                paymentWithPromo = promo;
                totalPaymentWithoutPromo -= promo;

                if (totalPaymentWithoutPromo >= balance) {
                    paymentWithBalance = balance;
                    balance = 0;
                    cash = totalPaymentWithoutPromo - paymentWithBalance;
                } else {
                    paymentWithBalance = totalPaymentWithoutPromo;
                    balance -= totalPaymentWithoutPromo;

                }
            } else {
                paymentWithPromo = totalSelectedSeats;
                cash = 0;
            }
        }


        $('#modelTotal').html(totalSelectedSeats.toFixed(2));
        $('#actualTotal').val(totalSelectedSeats.toFixed(2));

        $('#modelBalanceTotal').html(paymentWithBalance.toFixed(2));
        $('#balancePayment').val(paymentWithBalance.toFixed(2));

        $('#modelBalance').html(balance.toFixed(2));
        $('#actualBalance').val(balance.toFixed(2));

        $('#modelBonoTotal').html(paymentWithPromo.toFixed(2));
        $('#bonoPayment').val(paymentWithPromo.toFixed(2));

        $('#modelCashTotal').html(cash.toFixed(2));
        $('#cashPayment').val(cash.toFixed(2));

        $('#RequestedSpaces').val(requestedSpaces);
        $('#SpacesSelected').val(requestedSpacesControlIds);
        $('#SelectedSeatsTotalPrice').val(totalSelectedSeats);
                                                    });

    $(document).ready(function () {
        var currentDate = new Date('@Model.CurrentDate');

        // page is now ready, initialize the calendar...
        $('#dayCalendar').fullCalendar({
                                                        weekends: true,
            monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
            monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
            dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
            defaultView: 'listWeek',
            eventLimit: true, // for all non-agenda views
            contentHeight: "auto",
            header: {
                left: '',
                center: '',
                right: ''
            },
            eventRender: function (event, element, view) {
                                                // return $(`<tr class="fc-list-item ">
                                                //            <td class="fc-list-item-title fc-widget-content"><a><i class="fas fa-car"></i>  ` + new Date(event.start).toLocaleTimeString() + ` <br/> Origen: ` + event.from + ` <br/> Destino: ` + event.to+ `</a></td></tr>`);
                                                //},

                                                var starsStr = '';

                                                switch (event.stars) {
                    case 1:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star1" class="fa fa-star checked" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star2" class="fa fa-star" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star3" class="fa fa-star" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star4" class="fa fa-star" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star5" class="fa fa-star" data-toggle="Muy Malo"></span></a>`;
                                                        break;
                    case 2:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Malo"><span id="p-star1" class="fa fa-star checked" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star2" class="fa fa-star checked" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star3" class="fa fa-star" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star4" class="fa fa-star" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star5" class="fa fa-star" data-toggle="Malo"></span></a>`;
                                                        break;
                    case 3:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star1" class="fa fa-star checked" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star2" class="fa fa-star checked" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star3" class="fa fa-star checked" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star4" class="fa fa-star" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star5" class="fa fa-star" data-toggle="Bueno"></span></a>`;
                                                        break;
                    case 4:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star1" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star2" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star3" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star4" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star5" class="fa fa-star" data-toggle="Muy Bueno"></span></a>`;
                                                        break;
                    case 5:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star1" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star2" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star3" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star4" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star5" class="fa fa-star checked" data-toggle="Excelente"></span></a>`;
                                                        break;
                    case 0:
                        starsStr = `<a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star1" class="fa fa-star" data-toggle="¡No hay suficientes calificaciones!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star2" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star3" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star4" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star5" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>`;
                                                        break;
                }

                var allowPets = event.allowPets ? 'checked' : '';
                var allowLuggage = event.allowLuggage ? 'checked' : '';
                var allowSmoking = event.allowSmoking ? 'checked' : '';

                var hiddenPets = event.allowPets ? '' : 'hidden';
                var hiddenLuggage = event.allowLuggage ? '' : 'hidden';
                var hiddenSmoking = event.allowSmoking ? '' : 'hidden';

                var activePets = !event.allowPets ? '' : 'active';
                var activeLuggage = !event.allowLuggage ? '' : 'active';
                var activeSmoking = !event.allowSmoking ? '' : 'active';

                var html = `
                    <tr class="fc-list-item ">
                        <td class="fc-list-item-title fc-widget-content" colspan="2">
                            <div class="panel panel-default" style="border-radius:10px; padding:10px;">
                                <table>
                                    <tr class="fc-list-item ">
                                        <td class="fc-list-item-title fc-widget-content">
                                             <span class="fas fa-calendar-alt"></span><small><b> ` + formatddmmyyyy(new Date(event.start)) +`</b></small><br />

                                            <span class="fas fa-clock"></span>&nbsp;<small>` + formatAMPM(new Date(event.start)) + `</small>&nbsp;&nbsp;<span class="fas fa-map-marker-alt">&nbsp;</span><small class="from">` + event.from + `</small><br />
                                            <span class="fas fa-clock"></span>&nbsp;<small>`+ formatAMPM(new Date(event.end)) +`</small>&nbsp;&nbsp;<span class="fas fa-map-marker-alt">&nbsp;</span><small class="to">` + event.to + `</small><br />
                                        </td>
                                        <td class="fc-list-item-title fc-widget-content">
                                            <div class="pull-right" id="profile-container-small" data-toggle="tooltip" title="Conductor"><img id="profileImage" src="` + event.picture + `" /></div><br /><br /><br />
                                            <small class="pull-right"><small>` + starsStr + `</small></small><br/>
                                            <small class="pull-right">` + event.driver + `</small><br/>
                                        </td>
                                    </tr>
                                    <tr class="fc-list-item ">
                                        <td class="fc-list-item-title fc-widget-content">
                                             <b><span class="fas fa-route">&nbsp;</span>Ruta: </b><small class="route">` + event.route + `</small><br />
                                             <b><span class="fas fa-road">&nbsp;</span>Distancia: </b><small class="route">` + event.distance + ` km</small><br />
                                        </td>
                                        <td class="fc-list-item-title fc-widget-content">
                                            <small class="price"><b><span class="fas fa-money-bill-alt">&nbsp;</span>Cuota: </b> ` + event.currency + event.price + `</small><br />
                                            <small class="spaces"><b><span class="fas fa-car-side">&nbsp;</span>Espacios: </b> ` + event.availableSpaces + `</small><br />
                                        </td>
                                    </tr>
                                    <tr class="fc-list-item ">
                                        <td class="fc-list-item-title fc-widget-content" colspan="2" style="padding-left: 0px;padding-right: 0px;">
                                            <div id="pet" class="btn btn-xs btn-info panel panel-default `+ activePets + `" data-toggle="button" onclick="return false" aria-pressed="` + allowPets + `" style="border-radius:10px 0px 0px 10px; pointer-events:none;position:relative;right:-5px; width:60px">
                                                <span class="fas fa-dog">&nbsp;</span>&nbsp;<span id="check-pet" class="fas fa-check-circle `+ hiddenPets +`">&nbsp;</span><br /><small class="control-label" style="text-align:left">Mascotas </small>
                                            </div>
                                            <div id="luggage" class="btn btn-xs btn-info panel panel-default `+ activeLuggage + `" data-toggle="button" aria-pressed="` + allowLuggage +`" autocomplete="off" style="border-radius:0px;pointer-events:none; width:60px">
                                                <span class="fas fa-suitcase-rolling">&nbsp;</span>&nbsp;<span id="check-luggage" class="fas fa-check-circle `+ hiddenLuggage +`">&nbsp;</span><br /><small class="control-label" style="text-align:left">Equipaje </small>
                                            </div>
                                            <div id="smoking" class="btn btn-xs btn-info panel panel-default `+ activeSmoking + `" data-toggle="button" aria-pressed="` + allowSmoking +`" autocomplete="off" style="border-radius:0px 10px 10px 0px;pointer-events:none;position:relative;right:5px; width:60px">
                                                <span class="fas fa-smoking">&nbsp;</span>&nbsp;<span id="check-smoking" class="fas fa-check-circle `+ hiddenSmoking +`">&nbsp;</span><br /><small class="control-label" style="text-align:left">Fumado</small>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>`;

                return $(html)
            },
            allDaySlot: false,
            contentHeight: "auto",
            eventTextColor: 'black',
            views: {
                timelineDay: {
                    selectable: false
                }
            },
            events: [],
            contentHeight:500,
            eventClick: function (calEvent, jsEvent, view) {
                var date = new Date(calEvent.formatteddate);
                var date2 = new Date(calEvent.endformatteddate);
                var crDateStr = date.toLocaleString('es-CR', { year: "numeric", month: "2-digit", day: "numeric" });
                var crTimeStr1 = date.toLocaleString('es-CR', { hour: "2-digit", minute: "2-digit", hour12: true });
                var crTimeStr2 = date2.toLocaleString('es-CR', { hour: "2-digit", minute: "2-digit", hour12: true });
                var usStr = date.toLocaleString('en-US', { year: "numeric", month: "2-digit", day: "numeric", hour: "2-digit", minute: "2-digit", hour12: true });

                $("#dialog").dialog("open");
                //$('#ui-id-1').html("Reserva tu viaje");
                $('#modelFrom').html(calEvent.from);
                $('#modelTo').html(calEvent.to);
                $('#modelRoute').html(calEvent.route);
                $('#modelDate').html(crDateStr);
                $('#fromTime').html(crTimeStr1);
                $('#toTime').html(crTimeStr2);
                $('#modelDistance').html(calEvent.distance + ' km');
                $('#ReservationDate').val(date.getFullYear() + "/" + (date.getMonth() + 1) + "/" + date.getDate() + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds());
                $('#DriverId').val(calEvent.driverId);
                $('#modelDriver').html(calEvent.driver);
                $('#AvailableSpaces').val(calEvent.availableSpaces);
                $("#driver-img").attr("src", calEvent.picture);

                if (calEvent.allowPets) {
                    $('#modelpet').addClass('active');
                    $('#modelcheck-pet').removeClass('hidden');
                } else {
                    $('#modelpet').removeClass('active');
                    $('#modelcheck-pet').addClass('hidden');
                }

                if (calEvent.allowLuggage) {
                    $('#modelluggage').addClass('active');
                    $('#modelcheck-luggage').removeClass('hidden');
                } else {
                    $('#modelluggage').removeClass('active');
                    $('#modelcheck-luggage').addClass('hidden');
                }

                if (calEvent.allowSmoking) {
                    $('#modelsmoking').addClass('active');
                    $('#modelcheck-smoking').removeClass('hidden');
                } else {
                    $('#modelsmoking').removeClass('active');
                    $('#modelcheck-smoking').addClass('hidden');
                }

                $('#modelPrice').html(calEvent.price);
                $('#modelPriceCopilot').html((Number(calEvent.price) + 500));
                $('#modelPriceLeft').html((Number(calEvent.price)));
                $('#modelPriceMiddle').html((Number(calEvent.price) - 500));
                $('#modelPriceRight').html((Number(calEvent.price)));

                if (calEvent.copilotSeatTaken) {
                    $('#copilot-seat').prop('disabled', true);
                }
                if (calEvent.backLeftSeatTaken) {
                    $('#back-left-seat').prop('disabled', true);
                }
                if (calEvent.backMiddleSeatTaken) {
                    $('#back-middle-seat').prop('disabled', true);
                }
                if (calEvent.backRightSeatTaken) {
                    $('#back-right-seat').prop('disabled', true);
                }

                var bono = Number(@promo).toFixed(2);
                var defaultValue = Number(0).toFixed(2);
                $('#modelTotal').html(defaultValue);
                $('#modelBalanceTotal').html(defaultValue);
                $('#modelBonoTotal').html(bono);
                $('#modelCashTotal').html(defaultValue);

                $('#TripId').val(calEvent.id);

                var reservationAlreadyExistent = ExistReservationToTrip(calEvent.id)

                if (reservationAlreadyExistent) {
                    $('#already-reserved-message').html('<small class="pull-left text-danger">¡Ya contás con esta reservación!</small>');
                    $('#back-right-seat').attr('disabled', true);
                    $('#back-left-seat').attr('disabled', true);
                    $('#back-middle-seat').attr('disabled', true);
                    $('#copilot-seat').attr('disabled', true);
                    $('#btnsContainer').html('<input type="button" class="btn btn-default btn-sm" data-dismiss="modal" value="Cancelar" style="width:150px"/><input id="btnSubmitReservations" type="button" class="btn btn-info btn-sm" style="width:150px" value="Solicitar Reserva" disabled />');
                                        } else {
                    $('#msgTextModal').val('')
                                                //< input type = "button" onclick = "OpenMessageModel()" class="btn btn-default pull-left" value = "&#128386;" />
                    $('#btnsContainer').html('<input type="button" class="btn btn-default btn-sm" data-dismiss="modal" value="Cancelar" style="width:150px"/><input id="btnSubmitReservations" type="button" onclick="SubmitForm();" class="btn btn-info btn-sm" style="width:150px" value="Solicitar Reserva" />');
                                        }

                $("#dayTripModal").modal();
                                        //window.location.href = '/Reservations/Create?tripId=' + calEvent.id;
                                    }
        });

        var arrayOfTrips = JSON.parse('@Html.Raw(Json.Encode(Model.Trips))');

        for (var i = 0; i < arrayOfTrips.length; i++) {
            var tripId = arrayOfTrips[i].TripId;
            var availableSpaces = arrayOfTrips[i].AvailableSpaces;
            var dateTime = arrayOfTrips[i].DateTimeStr;
            var arrivalDateTime = arrayOfTrips[i].ArrivalDateTimeStr;
            var driverId = arrayOfTrips[i].ApplicationUser.Id;
            var driver = arrayOfTrips[i].ApplicationUser.Name + ' ' + arrayOfTrips[i].ApplicationUser.LastName;
            var price = arrayOfTrips[i].Price;
            var from = arrayOfTrips[i].FromTown.FullName;
            var to = arrayOfTrips[i].ToTown.FullName;
            var picture = arrayOfTrips[i].ApplicationUser.Picture.replace('|', '/').replace('|', '/').replace('|', '/').replace('|', '/').replace('~', '');
            var stars = arrayOfTrips[i].ApplicationUser.Stars;
            var route = 'No especificada'
            var distance = arrayOfTrips[i].AproxDistance;
            var allowPets = arrayOfTrips[i].AllowPets;
            var allowLuggage = arrayOfTrips[i].AllowLuggage;
            var allowSmoking = arrayOfTrips[i].AllowSmoking;
            var currency = '@currency';
            var copilotSeatTaken = false;
            var backLeftSeatTaken = false;
            var backMiddleSeatTaken = false;
            var backRightSeatTaken = false;

            for (var i2 = 0; i2 < arrayOfTrips[i].Reservations.length; i2++) {
                var spacesSelected = arrayOfTrips[i].Reservations[i2].SpacesSelected.split(';');

                for (var i3 = 0; i3 < spacesSelected.length; i3++) {
                    var space = spacesSelected[i3];

                    switch (space) {
                        case "modelPriceCopilot":
                            copilotSeatTaken = true;
                            break;
                        case "modelPriceLeft":
                            backLeftSeatTaken = true;
                            break;
                        case "modelPriceMiddle":
                            backMiddleSeatTaken = true;
                            break;
                        case "modelPriceRight":
                            backRightSeatTaken = true;
                            break;
                    }
                }
            }

            if (arrayOfTrips[i].Route != null) {
                route = arrayOfTrips[i].Route.Name;
            }

            var startDate = new Date(dateTime);
            var endDate = new Date(arrivalDateTime);
                                    //enddate is 30 mins more than startdate, getTime is in milliseconds so 30 mins will be 30*60*100 = 1,800,000 millisecods
                                    //var endDate = new Date(startDate.getTime() + 1800000);

                                    spacesMsg = "";

            if (availableSpaces == 1) {
                spacesMsg = "1 espacio";
            } else {
                spacesMsg = availableSpaces + "espacios";
            }

            var event = {
                id: tripId,
                start: startDate,
                end: endDate,
                color: '#2792F2',
                from: from,
                to: to,
                route: route,
                fromto: from + ' -> ' + to,
                driverId: driverId,
                driver: driver,
                picture: picture,
                stars: stars,
                distance: distance,
                availableSpaces: availableSpaces,
                formatteddate: startDate,
                endformatteddate: endDate,
                price: price.toFixed(2),
                copilotSeatTaken: copilotSeatTaken,
                backLeftSeatTaken: backLeftSeatTaken,
                backMiddleSeatTaken: backMiddleSeatTaken,
                backRightSeatTaken: backRightSeatTaken,
                currency: currency,
                allowPets: allowPets,
                allowLuggage: allowLuggage,
                allowSmoking: allowSmoking
            };

            console.log('Trip Info => From: ' + event.from + ', To: ' + event.to + ', Route: ' + event.route + ', Driver: ' + event.driver + ', Picture: ' + event.picture + ', Stars: ' + stars, ', Spaces: ' + event.availableSpaces + ', Price: ' + event.price);

            $('#dayCalendar').fullCalendar('renderEvent', event, true);
                                    }

        $('#dayCalendar').fullCalendar('gotoDate', startDate)
    });

    function ExistReservationToTrip(currentTripId) {
        var passengerReservations = JSON.parse('@Html.Raw(Json.Encode(Model.ExistentReservations))');

        for (var i = 0; i < passengerReservations.length; i++) {
            var existentReservationTripId = passengerReservations[i].TripId;

            if (existentReservationTripId == currentTripId) {
                return true;
            }
        }

        return false;
    }

    function OpenMessageModel() {
        var driverId = $('#DriverId').val();

        $('#MsgDriverId').val(driverId);
        $('#tripQuestionsModal').modal();
        $('#Message').focus();
    }

    function SendMessage() {
        var driverId = $('#MsgDriverId').val();
        var passengerId = $('#MsgPassengerId').val();
        var message = $('#Message').val();

        if (message == '') {
            displayMessages('100025', 'warning');
            $('#Message').focus();

            return;
        }

        $.post('/TripQuestions/SendQuestion', { driverId: driverId, passengerId: passengerId, tripQuestionInfoId: null, message: message },
            function (data) {
                if (data != '') {
                    //¡Mensaje Enviado!
                    displayMessages(data, 'info');
                    $('#Message').val('');
                    $('#Message').focus();
                }
            });
    }
</script>
