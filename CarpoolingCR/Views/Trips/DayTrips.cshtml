@model CarpoolingCR.Objects.Responses.TripDayTripsResponse

@{
    ViewBag.Title = "MonthTrips";
}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<div class="form-group">
    <h3>Viajes Disponibles</h3>

    <br />
    <label class="control-label">@ViewBag.Info</label>

    <input id="AvailableSpaces" type="hidden" value="" />
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <label class="control-label" style="text-align:left">Origen: </label> @Model.From <br /><label class="control-label" style="text-align:left">Destino: </label> @Model.To
        </div>
    </div>
    <div class="row form-group">
        <div id="dayCalendar" style="overflow:hidden" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="dayTripModal" tabindex="-1" role="dialog" aria-labelledby="dayTripModalLabel" aria-hidden="true">
    <form id="frmCreateReservation" action="~/Reservations/Create" method="post">
        <input id="RequestedSpaces" name="RequestedSpaces" type="text" class="hidden" style="width:40px;" onfocus="blur();">
        <input id="SpacesSelected" name="SpacesSelected" type="text" class="hidden" style="width:40px;" onfocus="blur();">
        <input id="SelectedSeatsTotalPrice" name="SelectedSeatsTotalPrice" type="text" class="hidden" style="width:40px;" onfocus="blur();">
        <input type="text" id="TripId" name="TripId" class="hidden" />
        @Html.AntiForgeryToken()
        <div class="vertical-alignment-helper">
            <div class="modal-dialog vertical-align-center">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                        </button>
                        <h4 class="modal-title" id="dayTripModalLabel">Reserva tu viaje</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-group">
                            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                                <div class="row form-group">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <div id="profile-container-small" data-toggle="tooltip" style="margin-right:10px" title="Conductor">
                                            <img id="driver-img" />
                                        </div>
                                        <small id="modelDriver"></small><br /><br />
                                    </div>
                                    <div class="row form-group" style="padding-left:20px; padding-right:20px">
                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                            <span class="fas fa-calendar-alt"></span><small> <b><small id="modelDate"></small></b></small><br />
                                            <input type="text" id="ReservationDate" name="ReservationDate" class="hidden" />

                                            <span class="fas fa-clock"></span>&nbsp;<small id="fromTime"></small>&nbsp;&nbsp;<br class="visible-xs" /><span class="fas fa-map-marker-alt">&nbsp;</span><small id="modelFrom"></small><br />
                                            <span class="fas fa-clock"></span>&nbsp;<small id="toTime"></small>&nbsp;&nbsp;<br class="visible-xs" /><span class="fas fa-map-marker-alt">&nbsp;</span><small id="modelTo"></small><br />
                                        </div>
                                    </div>
                                    <div class="row form-group" style="padding-left:20px; padding-right:0px">
                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                            <small><b><span class="fas fa-route">&nbsp;</span>Ruta: </b></small><small id="modelRoute"></small><br />
                                            <small><b><span class="fas fa-road">&nbsp;</span>Distancia: </b></small><small id="modelDistance"></small><br />
                                            <small><b><span class="fas fa-money-bill-alt">&nbsp;</span>Cuota: </b></small><small id="modelPrice"></small><br />
                                        </div>
                                    </div>
                                    <div class="row form-group" style="padding-left:20px; padding-right:0px">
                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                            <small class="price"><b><span class="fas fa-money-bill-alt">&nbsp;</span>Total: </b> <small>₡</small><small id="modelTotal"></small></small><br />
                                        </div>
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <div id="already-reserved-message">

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12" style="height:330px">
                                <table border="0" style="padding:0px;margin:0px;position:relative; top:-70px; left:-10px">
                                    <tr style="height:50px">
                                        <td colspan="3" style="height:50px">
                                            <div style="height: 15px;width: 40px;background-color: yellow;border-radius: 50%;position:relative; top:75px; left:20px; z-index:10; -ms-transform: rotate(-20deg); -webkit-transform: rotate(-20deg); transform: rotate(-20deg);"></div>
                                            <div style="height: 15px;width: 40px;background-color: yellow;border-radius: 50%;position:relative; top:60px; left:123px; z-index:10; -ms-transform: rotate(20deg); -webkit-transform: rotate(20deg); transform: rotate(20deg);"></div>
                                            <div style="border-radius:50px 50px 0px 0px; background-color:#004a93; width:100%; height:100px;position:relative;top:37px; left:0px;"></div>
                                            <div class="center-block" style="border-radius:50px 50px 0px 0px; background-color:gainsboro; width:100%; height:35px;position:relative; width:90%"></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="background-color:#004a93">
                                            <div class="seat" style="padding-left:10px; padding-right:0px">
                                                <input type="checkbox" disabled id="driver-seat" />
                                                <label for="driver-seat">Conductor</label>
                                            </div>
                                        </td>
                                        <td style="background-color:#004a93"></td>
                                        <td style="background-color:#004a93">
                                            <div class="seat" style="padding-left:0px; padding-right:10px">
                                                <input type="checkbox" id="copilot-seat" class="seats" />
                                                <label for="copilot-seat" style="color:darkblue"><small>₡</small><small id="modelPriceCopilot"></small></label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="background-color:#004a93">
                                            <div class="seat" style="padding-left:10px; padding-right:0px">
                                                <input type="checkbox" id="back-left-seat" class="seats" />
                                                <label for="back-left-seat" style="color:darkblue"><small>₡</small><small id="modelPriceLeft"></small></label>
                                            </div>
                                        </td>
                                        <td style="background-color:#004a93">
                                            <div class="seat" style="padding-left:0px; padding-right:0px">
                                                <input type="checkbox" id="back-middle-seat" class="seats" />
                                                <label for="back-middle-seat" style="color:darkblue"><small>₡</small><small id="modelPriceMiddle"></small></label>
                                            </div>
                                        </td>
                                        <td style="background-color:#004a93">
                                            <div class="seat" style="padding-left:0px; padding-right:10px">
                                                <input type="checkbox" id="back-right-seat" class="seats" />
                                                <label for="back-right-seat" style="color:darkblue"><small>₡</small><small id="modelPriceRight"></small></label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3">
                                            <div class="center-block" style="border-radius:0px 0px 25px 25px; background-color:#004a93; width:100%; height:60px;"></div>
                                            <div class="center-block" style="border-radius:0px 0px 50px 50px; background-color:gainsboro; width:90%; height:20px;position:relative;top:-60px; left:0px;"></div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div id="btnsContainer" class="modal-footer" style="top:-50px; padding-top:5px; padding-left:0px; padding-right:0px">
                            <input type="button" onclick="OpenMessageModel()" class="btn btn-default pull-left" value="&#9993;" />
                            <input type="button" class="btn btn-default btn-sm" data-dismiss="modal" value="Cancelar" />
                            <input id="btnSubmitReservations" type="button" onclick="SubmitForm();" style="width:150px" class="btn btn-info btn-sm" value="Solicitar Reserva" />
                        </div>
                        @*<div class="row form-group">
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                                    <div class="row form-group">
                                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                            <b><span class="fas fa-map-marker-alt">&nbsp;</span>Origen: </b>
                                        </div>
                                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                            <small id="modelFrom"></small>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                            <b><span class="fas fa-map-marker-alt">&nbsp;</span>Destino: </b>
                                        </div>
                                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                            <small id="modelTo"></small>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                            <b><span class="fas fa-route">&nbsp;</span>Ruta: </b>
                                        </div>
                                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                            <small id="modelRoute"></small>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                            <b><span class="fas fa-user-alt">&nbsp;</span>Conductor</b>
                                        </div>
                                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                            <small id="modelDriver"></small>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                            <b><span class="fas fa-calendar-alt">&nbsp;</span>Fecha</b>
                                        </div>
                                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                            <small id="modelDate"></small>
                                            <input type="text" id="ReservationDate" name="ReservationDate" class="hidden" />
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                            <b><span class="fas fa-money-bill-alt">&nbsp;</span>Total</b>
                                        </div>
                                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                            ₡<small id="modelTotal"></small>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                            <div id="already-reserved-message">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 align-items-center" style="text-align:center; height:320px">
                                    <div class="row" style="height:320px">
                                        <div class="visible-xs col-xs-3">

                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-5" style="height:320px">
                                            <table border="0" style="padding:0px;margin:0px;position:relative; top:-70px; left:-10px">
                                                <tr style="height:50px">
                                                    <td colspan="3" style="height:50px">
                                                        <div style="height: 15px;width: 40px;background-color: yellow;border-radius: 50%;position:relative; top:75px; left:20px; z-index:10; -ms-transform: rotate(-20deg); -webkit-transform: rotate(-20deg); transform: rotate(-20deg);"></div>
                                                        <div style="height: 15px;width: 40px;background-color: yellow;border-radius: 50%;position:relative; top:60px; left:123px; z-index:10; -ms-transform: rotate(20deg); -webkit-transform: rotate(20deg); transform: rotate(20deg);"></div>
                                                        <div style="border-radius:50px 50px 0px 0px; background-color:#004a93; width:100%; height:100px;position:relative;top:37px; left:0px;"></div>
                                                        <div class="center-block" style="border-radius:50px 50px 0px 0px; background-color:gainsboro; width:100%; height:35px;position:relative; width:90%"></div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:10px; padding-right:0px">
                                                            <input type="checkbox" disabled id="driver-seat" />
                                                            <label for="driver-seat">Conductor</label>
                                                        </div>
                                                    </td>
                                                    <td style="background-color:#004a93"></td>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:0px; padding-right:10px">
                                                            <input type="checkbox" id="copilot-seat" class="seats" />
                                                            <label for="copilot-seat" style="color:darkblue"><small>₡</small><small id="modelPriceCopilot"></small></label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:10px; padding-right:0px">
                                                            <input type="checkbox" id="back-left-seat" class="seats" />
                                                            <label for="back-left-seat" style="color:darkblue"><small>₡</small><small id="modelPriceLeft"></small></label>
                                                        </div>
                                                    </td>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:0px; padding-right:0px">
                                                            <input type="checkbox" id="back-middle-seat" class="seats" />
                                                            <label for="back-middle-seat" style="color:darkblue"><small>₡</small><small id="modelPriceMiddle"></small></label>
                                                        </div>
                                                    </td>
                                                    <td style="background-color:#004a93">
                                                        <div class="seat" style="padding-left:0px; padding-right:10px">
                                                            <input type="checkbox" id="back-right-seat" class="seats" />
                                                            <label for="back-right-seat" style="color:darkblue"><small>₡</small><small id="modelPriceRight"></small></label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3">
                                                        <div class="center-block" style="border-radius:0px 0px 25px 25px; background-color:#004a93; width:100%; height:60px;"></div>
                                                        <div class="center-block" style="border-radius:0px 0px 50px 50px; background-color:gainsboro; width:90%; height:20px;position:relative;top:-60px; left:0px;"></div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="visible-xs col-xs-4">

                                        </div>
                                    </div>
                                </div>
                            </div>*@
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="modal fade" id="tripQuestionsModal" tabindex="-1" role="dialog" aria-labelledby="tripQuestionsModalLabel" aria-hidden="true">
    @*<form action="~/Reservations/Create" method="post">*@
    @Html.AntiForgeryToken()
    <div class="vertical-alignment-helper">
        <div class="modal-dialog vertical-align-center">
            <div class="modal-content">
                <div class="modal-header">
                    <input type="text" id="MsgDriverId" name="MsgDriverId" class="hidden" />
                    <input type="text" id="MsgPassengerId" name="DriverId" class="hidden" value="@Model.CurrentUserId" />
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="dayTripModalLabel">Mensajes</h4>
                    <small>¿Alguna duda? ¡Contácta al conductor!</small>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <textarea class="form-control" id="Message" name="Message" style="height:200px; min-width:100%"></textarea>
                        </div>
                    </div>
                </div>
                <div id="btnsContainer" class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cerrar" />
                    <input type="button" class="btn btn-primary" onclick="SendMessage()" value="Enviar" />
                </div>
            </div>
        </div>
    </div>
    @*</form>*@
</div>

@*<tr class="fc-list-item ">
        <td class="fc-list-item-title fc-widget-content">
            <div class="panel panel-default" style="border-radius:10px; padding:10px;">
                <div class="row form-group" style="padding-left:20px">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <span class="fas fa-calendar-alt">&nbsp;17/10/2019</span><br />

                        &nbsp;<span class="fas fa-clock"></span>&nbsp;<small>9:00 am</small>&nbsp;&nbsp;<span class="fas fa-map-marker-alt">&nbsp;</span><small class="from">San Carlos, Ciudad Quesada</small><br />
                        &nbsp;<span class="fas fa-clock"></span>&nbsp;<small>12:30 pm</small>&nbsp;&nbsp;<span class="fas fa-map-marker-alt">&nbsp;</span><small class="to">San Jose, Zapote</small><br />
                    </div>
                </div>
                <div class="row form-group" style="padding-left:20px; padding-right:0px">
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                        <b>&nbsp;<span class="fas fa-route">&nbsp;</span>Ruta: </b><small class="route">Naranjo, Naranjo</small><br />
                        <b>&nbsp;<span class="fas fa-road">&nbsp;</span>Distancia: </b><small class="route">103 km</small><br />
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                        <small class="price"><b><span class="fas fa-money-bill-alt">&nbsp;</span>Cuota: </b> ₡4000</small><br />
                        <small class="spaces"><b><span class="fas fa-car-side">&nbsp;</span>Espacios: </b> 4</small><br />
                    </div>
                </div>
            </div>
        </td>
    </tr>*@

<link href="~/fonts/fullcalendar-3.10.0/fullcalendar.min.css" rel="stylesheet" />
<script src="~/fonts/fullcalendar-3.10.0/moment.min.js"></script>
<script src="~/fonts/fullcalendar-3.10.0/fullcalendar.min.js"></script>
<script>
    function SubmitForm() {
        if ($('#SpacesSelected').val() == '') {
            //¡Por favor seleccione al menos un campo!
            DisplayGrowlMessage('100073', 'warn');

            return;
        }

        $('#frmCreateReservation').submit();
    }
    var totalSelectedSeats = Number(0);

    $(".seats").change(function () {
    var controlId = this.id;
    var valueControlId = "";

    switch (controlId) {
        case "copilot-seat":
            valueControlId = "modelPriceCopilot";
            break;
        case "back-left-seat":
            valueControlId = "modelPriceLeft";
            break;
        case "back-middle-seat":
            valueControlId = "modelPriceMiddle";
            break;
        case "back-right-seat":
            valueControlId = "modelPriceRight";
            break;
    }

    var value = Number($('#' + valueControlId).html());


    if (this.checked) {
            totalSelectedSeats = Number(totalSelectedSeats) + value;
        } else {
            totalSelectedSeats = Number(totalSelectedSeats) - value;
        }

        var requestedSpaces = 0;
        var requestedSpacesControlIds = "";

        if($("#copilot-seat").prop('checked')){
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceCopilot;";
        }
        if ($("#back-left-seat").prop('checked')) {
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceLeft;";
        }
        if ($("#back-middle-seat").prop('checked')) {
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceMiddle;";
        }
        if ($("#back-right-seat").prop('checked')) {
            requestedSpaces++;
            requestedSpacesControlIds += "modelPriceRight;";
        }
        //valueControlId = "modelPriceCopilot";
        //break;
        //    case "back-left-seat":
        //valueControlId = "modelPriceLeft";
        //break;
        //    case "back-middle-seat":
        //valueControlId = "modelPriceMiddle";
        //break;
        //    case "back-right-seat":
        //valueControlId = "modelPriceRight";
        //break;

        //<input id="RequestedSpaces" name="RequestedSpaces" class="hidden" style="width:40px;" onfocus="blur();">
        //    <input id="SpacesSelected" name="SpacesSelected" class="hidden" style="width:40px;" onfocus="blur();">

        $('#modelTotal').html(totalSelectedSeats.toFixed(2));
        $('#RequestedSpaces').val(requestedSpaces);
        $('#SpacesSelected').val(requestedSpacesControlIds);
        $('#SelectedSeatsTotalPrice').val(totalSelectedSeats);
                                                    });

    $(document).ready(function () {
        var currentDate = new Date('@Model.CurrentDate');

        // page is now ready, initialize the calendar...
        $('#dayCalendar').fullCalendar({
                                                        weekends: true,
            monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
            monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
            dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
            defaultView: 'listWeek',
            eventLimit: true, // for all non-agenda views
            contentHeight: "auto",
            header: {
                                                            left: '',
                center: '',
                right: ''
            },
            eventRender: function (event, element, view) {
                                                // return $(`<tr class="fc-list-item ">
                                                //            <td class="fc-list-item-title fc-widget-content"><a><i class="fas fa-car"></i>  ` + new Date(event.start).toLocaleTimeString() + ` <br/> Origen: ` + event.from + ` <br/> Destino: ` + event.to+ `</a></td></tr>`);
                                                //},

                                                var starsStr = '';

                                                switch (event.stars) {
                    case 1:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star1" class="fa fa-star checked" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star2" class="fa fa-star" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star3" class="fa fa-star" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star4" class="fa fa-star" data-toggle="Muy Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Malo"><span id="p-star5" class="fa fa-star" data-toggle="Muy Malo"></span></a>`;
                                                        break;
                    case 2:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Malo"><span id="p-star1" class="fa fa-star checked" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star2" class="fa fa-star checked" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star3" class="fa fa-star" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star4" class="fa fa-star" data-toggle="Malo"></span></a>
                            <a href="#" data-toggle="tooltip" title="Malo"><span id="p-star5" class="fa fa-star" data-toggle="Malo"></span></a>`;
                                                        break;
                    case 3:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star1" class="fa fa-star checked" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star2" class="fa fa-star checked" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star3" class="fa fa-star checked" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star4" class="fa fa-star" data-toggle="Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Bueno"><span id="p-star5" class="fa fa-star" data-toggle="Bueno"></span></a>`;
                                                        break;
                    case 4:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star1" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star2" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star3" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star4" class="fa fa-star checked" data-toggle="Muy Bueno"></span></a>
                            <a href="#" data-toggle="tooltip" title="Muy Bueno"><span id="p-star5" class="fa fa-star" data-toggle="Muy Bueno"></span></a>`;
                                                        break;
                    case 5:
                        starsStr = `<a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star1" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star2" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star3" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star4" class="fa fa-star checked" data-toggle="Excelente"></span></a>
                            <a href="#" data-toggle="tooltip" title="Excelente"><span id="p-star5" class="fa fa-star checked" data-toggle="Excelente"></span></a>`;
                                                        break;
                    case -1:
                        starsStr = `<a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star1" class="fa fa-star" data-toggle="¡No hay suficientes calificaciones!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star2" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star3" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star4" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>
                            <a href="#" data-toggle="tooltip" title="¡Usuario no calificado!"><span id="p-star5" class="fa fa-star" data-toggle="¡Usuario no calificado!"></span></a>`;
                                                        break;
                }

                var html = `
                    <tr class="fc-list-item ">
                        <td class="fc-list-item-title fc-widget-content" colspan="2">
                            <div class="panel panel-default" style="border-radius:10px; padding:10px;">
                                <table>
                                    <tr class="fc-list-item ">
                                        <td class="fc-list-item-title fc-widget-content">
                                             <span class="fas fa-calendar-alt"></span><small><b> ` + formatddmmyyyy(new Date(event.start)) +`</b></small><br />

                                            <span class="fas fa-clock"></span>&nbsp;<small>` + formatAMPM(new Date(event.start)) + `</small>&nbsp;&nbsp;<span class="fas fa-map-marker-alt">&nbsp;</span><small class="from">` + event.from + `</small><br />
                                            <span class="fas fa-clock"></span>&nbsp;<small>`+ formatAMPM(new Date(event.end)) +`</small>&nbsp;&nbsp;<span class="fas fa-map-marker-alt">&nbsp;</span><small class="to">` + event.to + `</small><br />
                                        </td>
                                        <td class="fc-list-item-title fc-widget-content">
                                            <div class="pull-right" id="profile-container-small" data-toggle="tooltip" style="margin-right:20px" title="Conductor"><img id="profileImage" src="` + event.picture + `" /></div><br /><br /><br />
                                            <small class="pull-right" style="padding-right:5px">` + starsStr + `</small><br>
                                            <small class="pull-right">` + event.driver + `</small><br>
                                        </td>
                                    </tr>

                                    <tr class="fc-list-item ">
                                        <td class="fc-list-item-title fc-widget-content">
                                             <b><span class="fas fa-route">&nbsp;</span>Ruta: </b><small class="route">` + event.route + `</small><br />
                                             <b><span class="fas fa-road">&nbsp;</span>Distancia: </b><small class="route">` + event.distance + ` km</small><br />
                                        </td>
                                        <td class="fc-list-item-title fc-widget-content">
                                            <small class="price"><b><span class="fas fa-money-bill-alt">&nbsp;</span>Cuota: </b> ₡` + event.price + `</small><br />
                                            <small class="spaces"><b><span class="fas fa-car-side">&nbsp;</span>Espacios: </b> ` + event.availableSpaces + `</small><br />
                                        </td>
                                    </tr>

                                </table>
                            </div>
                        </td>
                    </tr>`;

                return $(html)
            },
            allDaySlot: false,
            contentHeight: "auto",
            eventTextColor: 'black',
            views: {
                timelineDay: {
                    selectable: false
                }
            },
            events: [],
            contentHeight:500,
            eventClick: function (calEvent, jsEvent, view) {
                var date = new Date(calEvent.formatteddate);
                var date2 = new Date(calEvent.endformatteddate);
                var crDateStr = date.toLocaleString('es-CR', { year: "numeric", month: "2-digit", day: "numeric" });
                var crTimeStr1 = date.toLocaleString('es-CR', { hour: "2-digit", minute: "2-digit", hour12: true });
                var crTimeStr2 = date2.toLocaleString('es-CR', { hour: "2-digit", minute: "2-digit", hour12: true });
                var usStr = date.toLocaleString('en-US', { year: "numeric", month: "2-digit", day: "numeric", hour: "2-digit", minute: "2-digit", hour12: true });

                $("#dialog").dialog("open");
                //$('#ui-id-1').html("Reserva tu viaje");
                $('#modelFrom').html(calEvent.from);
                $('#modelTo').html(calEvent.to);
                $('#modelRoute').html(calEvent.route);
                $('#modelDate').html(crDateStr);
                $('#fromTime').html(crTimeStr1);
                $('#toTime').html(crTimeStr2);
                $('#modelDistance').html(calEvent.distance + ' km');
                $('#ReservationDate').val(date.getFullYear() + "/" + (date.getMonth() + 1) + "/" + date.getDate() + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds());
                $('#DriverId').val(calEvent.driverId);
                $('#modelDriver').html(calEvent.driver);
                $('#AvailableSpaces').val(calEvent.availableSpaces);
                $("#driver-img").attr("src", calEvent.picture);

                //todo:validar aca cantidad de espacios
                //$('#RequestedSpaces').spinner('option', 'min', 1);
                //$('#RequestedSpaces').spinner('option', 'max', calEvent.availableSpaces);

                $('#modelPrice').html(calEvent.price);
                $('#modelPriceCopilot').html((Number(calEvent.price) + 500));
                $('#modelPriceLeft').html((Number(calEvent.price)));
                $('#modelPriceMiddle').html((Number(calEvent.price) - 500));
                $('#modelPriceRight').html((Number(calEvent.price)));

                if (calEvent.copilotSeatTaken) {
                    $('#copilot-seat').prop('disabled', true);
                }
                if (calEvent.backLeftSeatTaken) {
                    $('#back-left-seat').prop('disabled', true);
                }
                if (calEvent.backMiddleSeatTaken) {
                    $('#back-middle-seat').prop('disabled', true);
                }
                if (calEvent.backRightSeatTaken) {
                    $('#back-right-seat').prop('disabled', true);
                }

                var defaultValue = Number(0).toFixed(2);
                $('#modelTotal').html(defaultValue);
                $('#TripId').val(calEvent.id);

                var reservationAlreadyExistent = ExistReservationToTrip(calEvent.id)

                if (reservationAlreadyExistent) {
                    $('#already-reserved-message').html('<small class="pull-left text-warning">¡Ya tiene una reservación activa para este viaje!</small>');
                    $('#back-right-seat').attr('disabled', true);
                    $('#back-left-seat').attr('disabled', true);
                    $('#back-middle-seat').attr('disabled', true);
                    $('#copilot-seat').attr('disabled', true);
                    $('#btnsContainer').html('<input type="button" class="btn btn-default btn-sm" data-dismiss="modal" value="Cancelar" style="width:150px"/><input id="btnSubmitReservations" type="button" class="btn btn-info btn-sm" style="width:150px" value="Solicitar Reserva" disabled />');
                                        } else {
                    $('#msgTextModal').val('')
                                                //< input type = "button" onclick = "OpenMessageModel()" class="btn btn-default pull-left" value = "&#128386;" />
                    $('#btnsContainer').html('<input type="button" class="btn btn-default btn-sm" data-dismiss="modal" value="Cancelar" style="width:150px"/><input id="btnSubmitReservations" type="button" onclick="SubmitForm();" class="btn btn-info btn-sm" style="width:150px" value="Solicitar Reserva" />');
                                        }

                $("#dayTripModal").modal();
                                        //window.location.href = '/Reservations/Create?tripId=' + calEvent.id;
                                    }
        });

        var arrayOfTrips = JSON.parse('@Html.Raw(Json.Encode(Model.Trips))');

        for (var i = 0; i < arrayOfTrips.length; i++) {
            var tripId = arrayOfTrips[i].TripId;
            var availableSpaces = arrayOfTrips[i].AvailableSpaces;
            var dateTime = arrayOfTrips[i].DateTimeStr;
            var arrivalDateTime = arrayOfTrips[i].ArrivalDateTimeStr;
            var driverId = arrayOfTrips[i].ApplicationUser.Id;
            var driver = arrayOfTrips[i].ApplicationUser.Name + ' ' + arrayOfTrips[i].ApplicationUser.LastName;
            var price = arrayOfTrips[i].Price;
            var from = arrayOfTrips[i].FromTown.FullName;
            var to = arrayOfTrips[i].ToTown.FullName;
            var picture = arrayOfTrips[i].ApplicationUser.Picture.replace('|', '/').replace('|', '/').replace('|', '/').replace('|', '/').replace('~', '');
            var stars = arrayOfTrips[i].ApplicationUser.Stars;
            var route = 'No especificada'
            var distance = arrayOfTrips[i].AproxDistance;
            var copilotSeatTaken = false;
            var backLeftSeatTaken = false;
            var backMiddleSeatTaken = false;
            var backRightSeatTaken = false;

            for (var i2 = 0; i2 < arrayOfTrips[i].Reservations.length; i2++) {
                var spacesSelected = arrayOfTrips[i].Reservations[i2].SpacesSelected.split(';');

                for (var i3 = 0; i3 < spacesSelected.length; i3++) {
                    var space = spacesSelected[i3];

                    switch (space) {
                        case "modelPriceCopilot":
                            copilotSeatTaken = true;
                            break;
                        case "modelPriceLeft":
                            backLeftSeatTaken = true;
                            break;
                        case "modelPriceMiddle":
                            backMiddleSeatTaken = true;
                            break;
                        case "modelPriceRight":
                            backRightSeatTaken = true;
                            break;
                    }
                }
            }

            if (arrayOfTrips[i].Route != null) {
                route = arrayOfTrips[i].Route.Name;
            }

            var startDate = new Date(dateTime);
            var endDate = new Date(arrivalDateTime);
                                    //enddate is 30 mins more than startdate, getTime is in milliseconds so 30 mins will be 30*60*100 = 1,800,000 millisecods
                                    //var endDate = new Date(startDate.getTime() + 1800000);

                                    spacesMsg = "";

            if (availableSpaces == 1) {
                spacesMsg = "1 espacio";
            } else {
                spacesMsg = availableSpaces + "espacios";
            }

            var event = {
                                        id: tripId,
                start: startDate,
                end: endDate,
                color: '#2792F2',
                from: from,
                to: to,
                route: route,
                fromto: from + ' -> ' + to,
                driverId: driverId,
                driver: driver,
                picture: picture,
                stars: stars,
                distance: distance,
                availableSpaces: availableSpaces,
                formatteddate: startDate,
                endformatteddate: endDate,
                price: price.toFixed(2),
                copilotSeatTaken: copilotSeatTaken,
                backLeftSeatTaken: backLeftSeatTaken,
                backMiddleSeatTaken: backMiddleSeatTaken,
                backRightSeatTaken: backRightSeatTaken
            };

                                    console.log('Trip Info => From: ' + event.from + ', To: ' + event.to + ', Route: ' + event.route + ', Driver: ' + event.driver + ', Picture: ' + event.picture + ', Stars: ' + stars, ', Spaces: ' + event.availableSpaces + ', Price: ' + event.price);

            $('#dayCalendar').fullCalendar('renderEvent', event, true);
                                    }

        $('#dayCalendar').fullCalendar('gotoDate', startDate)
    });

    //$('#RequestedSpaces').spinner({
    //    stop: function (e, ui) {
    //        var price = parseFloat($('#modelPrice').html());
    //        var requestedSpaces = parseInt($('#RequestedSpaces').val());

    //        var total = price * requestedSpaces;

    //        $('#modelTotal').html(total.toFixed(2));

    //        return false;
    //    }
    //}).val(1);

    function ExistReservationToTrip(currentTripId) {
        var passengerReservations = JSON.parse('@Html.Raw(Json.Encode(Model.ExistentReservations))');

        for (var i = 0; i < passengerReservations.length; i++) {
            var existentReservationTripId = passengerReservations[i].TripId;

            if (existentReservationTripId == currentTripId) {
                return true;
            }
        }

        return false;
    }

    function OpenMessageModel() {
        var driverId = $('#DriverId').val();

        $('#MsgDriverId').val(driverId);
        $('#tripQuestionsModal').modal();
        $('#Message').focus();
    }

    function SendMessage() {
        var driverId = $('#MsgDriverId').val();
        var passengerId = $('#MsgPassengerId').val();
        var message = $('#Message').val();

        if (message == '') {
            displayMessages('100025', 'warning');
            $('#Message').focus();

            return;
        }

        $.post('/TripQuestions/SendQuestion', { driverId: driverId, passengerId: passengerId, tripQuestionInfoId: null, message: message },
            function (data) {
                if (data != '') {
                    //¡Mensaje Enviado!
                    displayMessages(data, 'info');
                    $('#Message').val('');
                    $('#Message').focus();
                }
            });
    }
</script>
