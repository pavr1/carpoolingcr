@model CarpoolingCR.Objects.Responses.HistorialResponse
@{
    ViewBag.Title = "LoadDriverTripHistorial";
}


@{
    if (Model.Trips.ToList().Count == 0)
    { <div class="row form-group" style="text-align:center">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                ¡No se encontraron viajes!
            </div>
        </div>
    }
    else
    {
        foreach (var trip in Model.Trips)
        {
            var driverId = trip.ApplicationUserId;
            var from = trip.FromTown.FullName;
            var to = trip.ToTown.FullName;
            var route = trip.Route.FullName;

            var claims = (System.Security.Claims.ClaimsIdentity)User.Identity;
            var value = string.Empty;
            var obj = claims.FindFirst("CurrencyChar");
            var currency = string.Empty;
            var country = string.Empty;

            if (obj != null)
            {
                currency = obj.Value;
            }

            <div class="row container">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 panel panel-default" style="border-radius:10px; padding-top:15px">
                    @Html.Partial("~/Views/Trips/Partials/p_TripHeader.cshtml", trip)
                    @{
                        if (trip.Reservations.Count == 0)
                        {
                            <div class="row form-group">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <small>¡No hubo reservaciones para este viaje!</small>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="row" style="padding:0px">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <label class="control-label from"><span class="fas fa-user">&nbsp;</span>Pasajeros: </label>
                                </div>
                            </div>
                            foreach (var reservation in trip.Reservations)
                            {
                                <div class="row form-group" style="padding:10px">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 panel panel-default" style="border-radius:10px; margin-bottom:0px; padding:10px">
                                        <div class="row">
                                            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                                                @Html.Partial("~/Views/Account/Partials/p_UserOverallInfo.cshtml", reservation.ApplicationUser)
                                            </div>

                                            @{
                                                var passengerId = reservation.ApplicationUserId;

                                                var passengerRating = trip.UserRatings.Where(x => x.FromId == driverId && x.ToId == passengerId).SingleOrDefault();
                                                var driverRating = trip.UserRatings.Where(x => x.FromId == passengerId && x.ToId == driverId).SingleOrDefault();

                                                <div class="col-lg-5 col-md-5 col-sm-5 col-xs-12">
                                                    <div class="row form-group">
                                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 panel panel-default" style="margin-left:15px; margin-right:15px; margin-bottom:0px; border-radius: 10px; text-align:center; display:inline; width:90%; height:125px; background-color:lightyellow">
                                                            <b>Tu calificación:</b><br />
                                                            @{
                                                                if (passengerRating == null)
                                                                {
                                                                    <small>¡No has calificado al pasajero!</small><br /><br />
                                                                    <input type="button" class="btn btn-info btn-sm" value="Calificar" onclick="PopUpQualifyModal(@reservation.TripId, '@trip.ApplicationUserId', '@reservation.ApplicationUserId', '@reservation.ApplicationUser.FullName', false,'#historial-container')" />
                                                                }
                                                                else
                                                                {
                                                                    @Html.Partial("~/Views/Account/Partials/p_UserStars.cshtml", passengerRating.Stars)
                                                                    <br />
                                                                    <small>@passengerRating.Comments</small>
                                                                }

                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-5 col-md-5 col-sm-5 col-xs-12">
                                                    <div class="row form-group" style="margin-bottom:0px">
                                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 panel panel-default" style="margin-left:15px; margin-right:15px; margin-bottom:0px; border-radius: 10px; text-align:center; display:inline; width:90%; height:125px; background-color:lightyellow">
                                                            <b>Calificación del pasajero:</b><br />
                                                            @{
                                                                if (driverRating == null)
                                                                {
                                                                    <small>¡No te ha calificado!</small><br /><br />
                                                                }
                                                                else
                                                                {
                                                                    @Html.Partial("~/Views/Account/Partials/p_UserStars.cshtml", driverRating.Stars)
                                                                    <br />
                                                                    <small>@driverRating.Comments</small>
                                                                }

                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    }
                </div>
            </div>
        }
    }
}
